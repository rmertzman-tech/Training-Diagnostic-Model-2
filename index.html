<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2: Diagnostic Practice (Enhanced)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .score-bar {
            height: 24px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        
        .nav-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .menu-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 8px;
            min-width: 250px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-document, #printable-document * {
                visibility: visible;
            }
            #printable-document {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .nav-menu {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Utility Functions
        const generateSessionId = () => {
            const date = new Date();
            const dateStr = date.toISOString().slice(0,10).replace(/-/g, '');
            const timeStr = date.toTimeString().slice(0,5).replace(/:/g, '');
            const random = Math.random().toString(36).substring(2, 8).toUpperCase();
            return `M2-${dateStr}-${timeStr}-${random}`;
        };

        const calculateAccuracy = (studentScores, expertScores) => {
            const capacityDiff = Math.abs(studentScores.capacity - expertScores.capacity);
            const capabilityDiff = Math.abs(studentScores.capability - expertScores.capability);
            const constructorDiff = Math.abs(studentScores.constructor - expertScores.constructor);
            const metaConstructorDiff = Math.abs(studentScores.metaConstructor - expertScores.metaConstructor);
            
            const avgDiff = (capacityDiff + capabilityDiff + constructorDiff + metaConstructorDiff) / 4;
            let accuracy = Math.max(0, 100 - avgDiff);
            
            // Bonus for matching primary diagnosis
            if (studentScores.primary === expertScores.primary) {
                accuracy = Math.min(100, accuracy + 10);
            }
            
            return Math.round(accuracy);
        };

        const determineSkillLevel = (accuracy) => {
            if (accuracy >= 85) return 'Proficient';
            if (accuracy >= 70) return 'Developing';
            return 'Novice';
        };

        // Enhanced Storage Management for Multiple Completions
        const loadProgressData = () => {
            const saved = localStorage.getItem('module2ProgressEnhanced');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                completions: [], // Array of completed sessions
                currentSession: null // In-progress session
            };
        };

        const saveProgressData = (data) => {
            localStorage.setItem('module2ProgressEnhanced', JSON.stringify(data));
        };

        const clearAllProgress = () => {
            if (confirm('This will delete ALL your saved work and completions. Are you sure?')) {
                localStorage.removeItem('module2ProgressEnhanced');
                window.location.reload();
            }
        };


        // Expert Diagnoses Data
        const EXPERT_DIAGNOSES = {
            case1: {
                capacity: 85,
                capability: 15,
                constructor: 30,
                metaConstructor: 20,
                primary: 'capacity',
                explanation: 'This is primarily a capacity suppression problem. The nurses clearly have the capacity for compassion (they entered the field because of it and show empathy with family), but chronic stress, impossible workloads, and constant exposure to suffering are preventing expression of this capacity. The biological substrates are being degraded by chronic stress (Sapolsky). This is NOT a capability gap - they know how to be compassionate. It\'s that the context is overwhelming their ability to express it.',
                commonMistake: 'Students often misdiagnose this as a capability gap (need more training in compassion). But notice they USED to perform well and still show compassion outside work - that indicates capacity exists but is suppressed by context.'
            },
            case2: {
                capacity: 20,
                capability: 80,
                constructor: 30,
                metaConstructor: 15,
                primary: 'capability',
                explanation: 'This is a capability gap problem. People have the capacity for ethical reasoning and want to do the right thing, but lack reliable protocols and procedures for actually implementing ethics in their specific roles. Teaching abstract principles doesn\'t help because the problem isn\'t values - it\'s the absence of clear, practiced, reliable methods for ethical action in context. They need capability development: clear specifications, practiced procedures, and reliable patterns of coordination.',
                commonMistake: 'Students sometimes think this is a constructor problem (need to institutionalize). But you can\'t institutionalize what doesn\'t exist yet - first you need to develop the capabilities, THEN institutionalize them.'
            },
            case3: {
                capacity: 25,
                capability: 40,
                constructor: 85,
                metaConstructor: 20,
                primary: 'constructor',
                explanation: 'This is a constructor failure. The ethical practices were working but depended entirely on the founder\'s personal presence rather than being institutionalized in structures, rituals, and norms that persist across personnel changes. When the founder left, the knowledge and practices left too. This shows the patterns were never properly built into persistent constructors - they were capability-level (worked when the founder used them) but never became constructor-level (work automatically and persist).',
                commonMistake: 'Students might think this is capacity suppression (people lost motivation). But the issue is that practices weren\'t institutionalized - they need to rebuild constructors that don\'t depend on any individual.'
            },
            case4: {
                capacity: 30,
                capability: 35,
                constructor: 40,
                metaConstructor: 85,
                primary: 'metaConstructor',
                explanation: 'This is a meta-constructor absence problem. The policy is causing clear harm but there\'s no mechanism to examine, challenge, or revise it. The system cannot learn from mistakes or adapt to new information. This is the absence of meta-constructor capacity at the institutional level - no review mechanisms, no sunset clauses, no safe channels for challenge, no learning loops. The system is locked in and cannot improve itself.',
                commonMistake: 'Students might focus on the bad policy content (a capability problem). But the deeper issue is that there\'s no way to FIX bad policies when discovered - that\'s the meta-constructor problem.'
            },
            case5: {
                capacity: 70,
                capability: 60,
                constructor: 40,
                metaConstructor: 30,
                primary: 'capacity',
                explanation: 'This is a multi-level problem requiring integrated intervention. PRIMARY: Capacity suppression - students are chronically stressed, sleep-deprived, and overloaded, which degrades their ability to learn and make good decisions. SECONDARY: Capability gap - many lack effective study skills and time management. TERTIARY: Constructor failure - a culture of cheating has normalized unethical behavior. Must address all levels, but start with capacity (reduce stressors, provide support) while simultaneously building capabilities and changing culture.',
                commonMistake: 'Students often jump to "it\'s the culture" (constructor) and miss that stressed, desperate students with poor study skills are being pushed toward cheating by impossible circumstances. Must address context first.'
            },
            case6: {
                capacity: 50,
                capability: 55,
                constructor: 65,
                metaConstructor: 45,
                primary: 'various',
                explanation: 'This ambiguous case has multiple reasonable interpretations. Is the family\'s capacity being suppressed by their beliefs, or do they have different but equally valid values? Is this a capability gap (they don\'t understand medical facts) or a genuine value difference? Reasonable people can disagree. Key insight: Sometimes diagnostic uncertainty means we need MORE INFORMATION before intervening. Humility about our ability to diagnose others\' capacity, especially across cultural/religious differences, is essential. Whatever your diagnosis, you must defend it with evidence and acknowledge uncertainty.',
                commonMistMistake: 'Rushing to judgment without acknowledging legitimate ambiguity and the need for more information, especially in cross-cultural contexts.'
            }
        };

        // Cases Data
        const CASES = [
            {
                id: 'case1',
                title: 'The Burned-Out Nurses',
                difficulty: 1,
                domain: 'Healthcare',
                scenario: `St. Mary's Hospital has been experiencing a troubling pattern over the past 18 months. Nurses who were once known for their compassionate care are increasingly showing signs of emotional detachment. Patients complain about curt responses and lack of empathy. Family members report nurses seeming "checked out" or irritable.

However, when you look at individual nurses' backgrounds, they all entered healthcare because of genuine compassion. They volunteer in their communities. They show deep empathy with their own families. Some were voted "most compassionate" just a few years ago.

The context: The hospital has been chronically understaffed due to budget cuts. Nurses regularly work 12-14 hour shifts with minimal breaks. They're required to care for 8-10 patients each when best practice recommends 4-5. Many report having no time to properly care for patients - having to rush through basic needs. Moral injury is common: knowing what patients need but being unable to provide it. Staff meetings have been cancelled. There's constant exposure to suffering and death without time for processing.`,
                stakeholders: 'Nurses (burned out), Patients (receiving substandard care), Hospital administrators (budget constraints), Families (concerned)',
                context: 'Chronic understaffing, impossible workloads, budget cuts, no processing time, moral injury',
                problem: 'Previously compassionate nurses showing reduced empathy and care quality',
                question: 'What level is the primary problem, and what type of intervention is needed?'
            },
            {
                id: 'case2',
                title: 'The Ethics Training Failure',
                difficulty: 1,
                domain: 'Business',
                scenario: `TechCorp brought in expensive ethics consultants to address concerning behavior: favoritism in promotions, inconsistent standards, occasional harassment going unaddressed. The consultants provided comprehensive training on ethical principles, values, and moral philosophy. Everyone completed the training. Exit surveys showed people found it "inspiring" and felt motivated to "do better."

Three months later, nothing has changed. The same problems persist. When you interview employees, they say things like: "I want to be fair, but how do I actually decide between candidates when both are qualified?" "I know harassment is wrong, but what specifically do I say when I witness it?" "The values are great but there's no clear process for applying them."

The context: TechCorp has vague policies that say things like "be ethical" and "treat people fairly" but no clear protocols for specific situations. There's no standardized interview process, no clear guidelines for addressing harassment, no consistent performance evaluation criteria. Managers are left to "use their judgment" with no training in how to implement that judgment reliably.`,
                stakeholders: 'Employees (want to do right but unsure how), Managers (lack clear protocols), Ethics consultants (taught principles, not practices)',
                context: 'Vague policies, no clear protocols, no standardized processes, "use your judgment" without guidance',
                problem: 'Ethics training doesn\'t translate to behavior change',
                question: 'Why didn\'t the ethics training work, and what\'s actually needed?'
            },
            {
                id: 'case3',
                title: 'When the Founder Leaves',
                difficulty: 1,
                domain: 'Organizational',
                scenario: `GreenFuture, a sustainable business consultancy, was founded by Maya Chen, a charismatic leader deeply committed to both environmental and social ethics. Under her leadership, the company had an outstanding reputation. They turned down lucrative contracts if clients wouldn't commit to genuine sustainability. Employees felt empowered to raise ethical concerns. Regular meetings addressed dilemmas thoughtfully.

Maya was the person everyone went to with questions. She personally modeled ethical decision-making. She told stories that conveyed the company's values. She made final calls on difficult trade-offs. When she announced her retirement, everyone was nervous but assumed her deputy would maintain the culture.

Within six months of Maya's departure, things fell apart. The deputy didn't have Maya's moral clarity. Without her stories and personal example, people lost confidence in their own
